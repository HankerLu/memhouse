<!--index.wxml-->
<view class="container">
  <view class="main-image-container">

    <!-- 两个悬浮的对话圈圈 -->
    <view class="floating-buttons">
      <view class="floating-button {{analyzing ? 'analyzing' : ''}}" 
            bindtap="chooseImage" 
            catch:tap="chooseImage">
        <view class="circle-button">
          <text>{{analyzing ? '分析中...' : '选择照片'}}</text>
        </view>
      </view>

      <!-- 仅在有关键词时显示AI写诗按钮 -->
      <view class="floating-button poetry-button" 
            bindtap="goToAIPoetry" 
            catch:tap="goToAIPoetry"
            wx:if="{{keywords.length > 0}}">
        <view class="circle-button">
          <text>AI写诗</text>
        </view>
      </view>
    </view>

    <!-- Canvas 元素 - 移除 wx:if 条件，确保 Canvas 始终存在 -->
    <canvas 
      type="2d" 
      id="animationCanvas"
      class="animation-canvas"
    ></canvas>

    <!-- 在 animation-canvas 元素上方添加 -->
    <text class="floating-dialog" decode="{{true}}">{{dialogText}}</text>
  </view>

  <!-- 仅在有关键词时显示关键词部分 -->
  <view class="keywords-section" wx:if="{{keywords.length > 0}}">
    <view class="keywords">
      <text class="keyword {{item.selected ? 'selected' : ''}}" 
            wx:for="{{keywords}}" 
            wx:key="index"
            bindtap="toggleKeyword"
            data-index="{{index}}">
        {{item.text}}
      </text>
    </view>

    <!-- 添加生成诗歌按钮 -->
    <view class="generate-button" bindtap="generatePoetry">
      生成诗歌
    </view>
  </view>

  <view class="download-progress" wx:if="{{downloadProgress < 100}}">
    <text>正在下载资源: {{currentFile}}</text>
    <progress percent="{{downloadProgress}}" show-info="true" />
  </view>
  </view>
