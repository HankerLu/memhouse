<!--index.wxml-->
<view class="container">
  <view class="main-image-container">

    <!-- 悬浮按钮 -->
    <view class="floating-buttons">
      <view class="floating-button {{analyzing ? 'analyzing' : ''}}" 
            bindtap="chooseImage" 
            catch:tap="chooseImage">
        <view class="circle-button">
          <text>{{analyzing ? '分析中...' : '选择照片'}}</text>
        </view>
      </view>
    </view>

    <!-- 只保留一个 Canvas -->
    <canvas 
      type="2d" 
      id="animationCanvas"
      class="animation-canvas"
      style="width: {{canvasWidth}}px; height: {{canvasHeight}}px;"
    ></canvas>

    <!-- 图片容器 -->
    <view class="selected-image-container {{tempImagePath ? 'visible' : ''}}">
      <image 
        class="selected-image" 
        mode="aspectFit" 
        src="{{tempImagePath}}" 
        wx:if="{{tempImagePath}}"
      ></image>
    </view>

    <!-- 对话框 -->
    <text class="floating-dialog" decode="{{true}}">{{dialogText}}</text>
  </view>

  <!-- 仅在有关键词时显示关键词部分 -->
  <view class="keywords-section" wx:if="{{keywords.length > 0}}">
    <view class="keywords">
      <text class="keyword {{item.selected ? 'selected' : ''}}" 
            wx:for="{{keywords}}" 
            wx:key="index"
            bindtap="toggleKeyword"
            data-index="{{index}}">
        {{item.text}}
      </text>
    </view>

    <!-- 添加生成诗歌按钮 -->
    <view class="generate-button" bindtap="generatePoetry">
      生成诗歌
    </view>
  </view>

  <view class="download-progress" wx:if="{{downloadProgress < 100}}">
    <text>正在下载资源: {{currentFile}}</text>
    <progress percent="{{downloadProgress}}" show-info="true" />
  </view>
  </view>
